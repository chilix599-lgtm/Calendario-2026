<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IAgenda</title>
    
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/chilix599-lgtm/Calendario-2026/main/lol.png">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/chilix599-lgtm/Calendario-2026/main/lol.png">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Agenda 26">
    <meta name="theme-color" content="#b8860b">

    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; padding: 20px; color: #333; margin: 0; }
        h1 { text-align: center; margin-bottom: 10px; color: #b8860b; }
        
        .controls { 
            position: sticky; top: 10px; background: white; padding: 15px; 
            border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 20px; z-index: 100;
            margin-bottom: 30px;
        }

        .tool-section { display: flex; align-items: center; gap: 10px; border-right: 1px solid #eee; padding-right: 20px; }
        .tool-section:last-child { border-right: none; }

        .color-btn { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 3px solid #eee; display: flex; align-items: center; justify-content: center; }
        .color-btn.active { border-color: #b8860b; transform: scale(1.1); box-shadow: 0 0 8px rgba(184,134,11,0.4); }
        .bg-red { background-color: #f8d7da; }
        .bg-white { background-color: #ffffff; border: 3px solid #ddd; }

        .search-container { position: relative; display: flex; align-items: center; }
        .search-input { padding: 8px 12px 8px 35px; border: 2px solid #ddd; border-radius: 20px; width: 180px; outline: none; }
        .search-icon { position: absolute; left: 12px; color: #999; }

        .calendar-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; }
        .month { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .month-title { text-transform: capitalize; font-weight: bold; color: #b8860b; border-bottom: 2px solid #f0f0f0; margin-bottom: 10px; }
        
        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .day-header { font-size: 0.7rem; text-align: center; color: #bbb; font-weight: 600; }
        
        .day { 
            border: 1px solid #f0f0f0; height: 85px; padding: 5px; cursor: pointer; border-radius: 4px; 
            display: flex; flex-direction: column; overflow: hidden; background: white;
        }
        .day.today { border: 2px solid #b8860b; background-color: #fffcf0 !important; }
        .day.holiday { background-color: #fff5f5; border-color: #ffcccc; }
        .day.highlight { border: 2px solid #b8860b; box-shadow: 0 0 8px rgba(184,134,11,0.4); }

        .day-top-row { display: flex; justify-content: space-between; align-items: center; }
        .day-number { font-size: 0.8rem; font-weight: bold; }
        .weather-tag { font-size: 0.65rem; color: #ff9800; }
        .holiday-name { font-size: 0.55rem; color: #d9534f; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .day-preview { font-size: 0.6rem; color: #444; overflow-y: auto; flex-grow: 1; scrollbar-width: none; margin-top: 2px; }
        .day-preview::-webkit-scrollbar { display: none; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 400px; }
        .modal-textarea { width: 100%; height: 150px; margin: 10px 0; padding: 12px; border: 1px solid #ddd; border-radius: 8px; resize: none; box-sizing: border-box; }
        .btn-save { width: 100%; padding: 12px; background: #b8860b; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }

        @media print { .controls { display: none !important; } .day { height: auto; min-height: 80px; } }
    </style>
</head>
<body>

    <h1 id="mainTitle">Agenda 2026</h1>

    <div class="controls">
        <div class="tool-section">
            <span style="font-size: 0.8rem; font-weight: bold;">Modo:</span>
            <div id="btnWhite" class="color-btn bg-white active" onclick="setTool('white')">‚ö™</div>
            <div id="btnRed" class="color-btn bg-red" onclick="setTool('#f8d7da')">üö©</div>
        </div>
        <div class="search-container">
            <span class="search-icon">üîç</span>
            <input type="text" id="searchInput" class="search-input" placeholder="Buscar..." oninput="handleSearch()">
        </div>
        <button onclick="window.print()" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold;">PDF</button>
    </div>

    <div id="calendar" class="calendar-grid"></div>

    <div id="dayModal" class="modal">
        <div class="modal-content">
            <h3 id="modalDate" style="margin:0; color: #b8860b;"></h3>
            <textarea id="modalText" class="modal-textarea"></textarea>
            <button class="btn-save" onclick="saveFromModal()">Guardar</button>
            <button style="width:100%; margin-top:8px; background:none; border:none; color:gray; cursor:pointer;" onclick="closeModal()">Cancelar</button>
        </div>
    </div>

    <script>
        const currentYear = new Date().getFullYear();
        document.getElementById('mainTitle').innerText = `Agenda ${currentYear}`;
        let selectedToolColor = 'white';
        let currentEditingDayId = null;
        const months = ["enero", "febrero", "marzo", "abril", "mayo", "junio", "julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"];
        const dayNames = ["Dom", "Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b"];

        // Festivos de Espa√±a (Nacionales + Regi√≥n de Murcia) para 2026
        const holidays2026 = {
            "0-1": "A√±o Nuevo",
            "0-6": "Reyes Magos",
            "2-19": "San Jos√©",
            "3-2": "Jueves Santo",
            "3-3": "Viernes Santo",
            "4-1": "D√≠a del Trabajo",
            "5-9": "D√≠a Regi√≥n de Murcia",
            "7-15": "Asunci√≥n",
            "9-12": "Fiesta Nacional",
            "10-1": "Todos los Santos",
            "11-6": "Constituci√≥n",
            "11-8": "Inmaculada",
            "11-25": "Navidad"
        };

        function setTool(color) {
            selectedToolColor = color;
            document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
            if(color === 'white') document.getElementById('btnWhite').classList.add('active');
            else document.getElementById('btnRed').classList.add('active');
        }

        function load() { return JSON.parse(localStorage.getItem(`agenda_${currentYear}`) || '{}'); }

        function save(id, value, type) {
            const data = load();
            if (!data[id]) data[id] = {};
            data[id][type] = value;
            localStorage.setItem(`agenda_${currentYear}`, JSON.stringify(data));
        }

        function renderCalendar() {
            const container = document.getElementById('calendar');
            container.innerHTML = '';
            const savedData = load();
            const today = new Date();

            months.forEach((monthName, monthIndex) => {
                const monthDiv = document.createElement('div');
                monthDiv.className = 'month';
                monthDiv.innerHTML = `<div class="month-title">${monthName} ${currentYear}</div>`;
                
                const daysGrid = document.createElement('div');
                daysGrid.className = 'days-grid';
                dayNames.forEach(d => daysGrid.innerHTML += `<div class="day-header">${d}</div>`);

                const firstDay = new Date(currentYear, monthIndex, 1).getDay();
                const daysInMonth = new Date(currentYear, monthIndex + 1, 0).getDate();

                for (let i = 0; i < firstDay; i++) daysGrid.innerHTML += `<div></div>`;

                for (let d = 1; d <= daysInMonth; d++) {
                    const dayId = `${monthIndex}-${d}`;
                    const dayData = savedData[dayId] || {};
                    const isToday = today.getFullYear() === currentYear && today.getMonth() === monthIndex && today.getDate() === d;
                    const holidayName = holidays2026[dayId];
                    
                    const dayDiv = document.createElement('div');
                    dayDiv.className = `day ${isToday ? 'today' : ''} ${holidayName ? 'holiday' : ''}`;
                    dayDiv.style.backgroundColor = dayData.color || (holidayName ? '#fff5f5' : 'white');
                    dayDiv.onclick = () => {
                        save(dayId, selectedToolColor, 'color');
                        currentEditingDayId = dayId;
                        document.getElementById('modalDate').innerText = `${d} de ${monthName}`;
                        document.getElementById('modalText').value = dayData.text || '';
                        document.getElementById('dayModal').style.display = 'flex';
                    };
                    
                    dayDiv.innerHTML = `
                        <div class="day-top-row">
                            <div class="day-number">${d}</div>
                            ${isToday ? '<span class="weather-tag">‚òÄÔ∏è 18¬∞C</span>' : ''}
                        </div>
                        ${holidayName ? `<div class="holiday-name">${holidayName}</div>` : ''}
                        <div class="day-preview">${dayData.text || ''}</div>
                    `;
                    daysGrid.appendChild(dayDiv);
                }
                monthDiv.appendChild(daysGrid);
                container.appendChild(monthDiv);
            });
        }

        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.day').forEach(day => {
                const text = day.innerText.toLowerCase();
                day.style.opacity = (query === "" || text.includes(query)) ? "1" : "0.15";
            });
        }

        function closeModal() { document.getElementById('dayModal').style.display = 'none'; renderCalendar(); }
        function saveFromModal() { save(currentEditingDayId, document.getElementById('modalText').value, 'text'); closeModal(); }

        renderCalendar();
    </script>
</body>
</html>
