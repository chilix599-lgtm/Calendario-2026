<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario 2026 Inteligente con Buscador</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        h1 { text-align: center; margin-bottom: 20px; }
        
        /* Controles */
        .controls { 
            position: sticky; top: 10px; background: white; padding: 15px; 
            border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 15px; z-index: 100;
            margin-bottom: 30px;
        }
        .search-container { position: relative; display: flex; align-items: center; }
        .search-input { 
            padding: 8px 12px 8px 35px; border: 2px solid #ddd; border-radius: 20px; 
            outline: none; transition: 0.3s; width: 200px;
        }
        .search-input:focus { border-color: #007bff; width: 250px; }
        .search-icon { position: absolute; left: 12px; color: #999; }

        .color-btn { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 3px solid #eee; transition: 0.2s; }
        .color-btn.active { border-color: #333; transform: scale(1.1); }
        .bg-green { background-color: #d4edda; }
        .bg-red { background-color: #f8d7da; }
        .bg-white { background-color: #ffffff; border: 3px solid #ddd; }

        .btn-print {
            background: #28a745; color: white; border: none; padding: 8px 16px;
            border-radius: 8px; cursor: pointer; font-weight: bold;
        }

        /* Grilla */
        .calendar-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
            gap: 25px; 
        }
        .month { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: 0.3s; }
        .month.hidden { display: none; } 
        
        .month-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px solid #f0f0f0; padding-bottom: 5px; }
        .month-title { text-transform: capitalize; font-weight: bold; font-size: 1.1rem; }
        .clear-month { font-size: 0.7rem; color: #999; cursor: pointer; text-decoration: underline; }
        
        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .day-header { font-size: 0.75rem; text-align: center; color: #bbb; font-weight: 600; }
        
        .day { 
            border: 1px solid #f0f0f0; min-height: 55px; padding: 6px; 
            cursor: pointer; border-radius: 6px; transition: 0.2s;
            display: flex; flex-direction: column; opacity: 1;
            position: relative;
        }

        /* ESTILO D√çA ACTUAL */
        .day.today { 
            border: 2px solid #0056b3 !important; 
            background-color: #e7f1ff !important;
            transform: scale(1.02);
            z-index: 1;
        }
        .day.today::after {
            content: "HOY";
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 0.5rem;
            font-weight: bold;
            color: #0056b3;
        }

        .day.fade { opacity: 0.2; transform: scale(0.95); }
        .day.highlight { border: 2px solid #007bff; box-shadow: 0 0 10px rgba(0,123,255,0.3); }

        .day-number { font-size: 0.85rem; font-weight: bold; }
        .day-preview { font-size: 0.65rem; color: #666; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* Modal */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center;
            backdrop-filter: blur(2px);
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 450px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: pop 0.25s ease;
        }
        @keyframes pop { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        
        .modal-textarea { 
            width: 100%; height: 180px; border: 1px solid #eee; border-radius: 10px; 
            padding: 15px; font-size: 1rem; outline: none; box-sizing: border-box; resize: none;
        }
        .btn-save { width: 100%; margin-top: 15px; padding: 12px; border: none; background: #007bff; color: white; border-radius: 10px; cursor: pointer; font-weight: bold; }

        @media print {
            .controls, .clear-month, .close-btn, .btn-save { display: none !important; }
            .calendar-grid { display: block; }
            .month { border: 1px solid #eee; margin-bottom: 20px; page-break-inside: avoid; }
        }
    </style>
</head>
<body>

    <h1>üìÖ Calendario 2026</h1>

    <div class="controls">
        <div class="search-container">
            <span class="search-icon">üîç</span>
            <input type="text" id="searchInput" class="search-input" placeholder="Buscar en mis notas..." oninput="handleSearch()">
        </div>

        <div style="display: flex; gap: 8px; align-items: center;">
            <div class="color-btn bg-white active" onclick="setColor('white', this)" title="Blanco"></div>
            <div class="color-btn bg-green" onclick="setColor('#d4edda', this)" title="Verde"></div>
            <div class="color-btn bg-red" onclick="setColor('#f8d7da', this)" title="Rojo"></div>
        </div>

        <button class="btn-print" onclick="window.print()">üñ®Ô∏è Imprimir / PDF</button>
    </div>

    <div id="calendar" class="calendar-grid"></div>

    <div id="dayModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div id="modalDate" style="font-size: 1.2rem; font-weight: bold;"></div>
                <span style="cursor: pointer; font-size: 1.5rem;" onclick="closeModal()">&times;</span>
            </div>
            <textarea id="modalText" class="modal-textarea"></textarea>
            <button class="btn-save" onclick="saveFromModal()">Guardar</button>
        </div>
    </div>

    <script>
        let selectedColor = 'white';
        let currentEditingDayId = null;
        const months = ["enero", "febrero", "marzo", "abril", "mayo", "junio", "julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"];
        const dayNames = ["Dom", "Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b"];

        function setColor(color, element) {
            selectedColor = color;
            document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
        }

        function load() { return JSON.parse(localStorage.getItem('cal2026') || '{}'); }

        function save(id, value, type) {
            const data = load();
            if (!data[id]) data[id] = {};
            data[id][type] = value;
            localStorage.setItem('cal2026', JSON.stringify(data));
        }

        function clearMonth(monthIndex) {
            if(confirm(`¬øBorrar todo en ${months[monthIndex]}?`)) {
                const data = load();
                Object.keys(data).forEach(key => { if(key.startsWith(`${monthIndex}-`)) delete data[key]; });
                localStorage.setItem('cal2026', JSON.stringify(data));
                renderCalendar();
            }
        }

        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const monthDivs = document.querySelectorAll('.month');

            monthDivs.forEach(month => {
                let monthHasMatch = false;
                const monthDays = month.querySelectorAll('.day');
                
                monthDays.forEach(day => {
                    const text = day.querySelector('.day-preview').innerText.toLowerCase();
                    if (query === "") {
                        day.classList.remove('fade', 'highlight');
                        monthHasMatch = true;
                    } else if (text.includes(query)) {
                        day.classList.remove('fade');
                        day.classList.add('highlight');
                        monthHasMatch = true;
                    } else {
                        day.classList.add('fade');
                        day.classList.remove('highlight');
                    }
                });

                if (monthHasMatch) month.classList.remove('hidden');
                else month.classList.add('hidden');
            });
        }

        function openModal(dayId, fullDate) {
            currentEditingDayId = dayId;
            const data = load();
            document.getElementById('modalDate').innerText = fullDate;
            document.getElementById('modalText').value = data[dayId]?.text || '';
            document.getElementById('dayModal').style.display = 'flex';
            if(selectedColor !== 'white') save(dayId, selectedColor, 'color');
        }

        function closeModal() {
            document.getElementById('dayModal').style.display = 'none';
            renderCalendar();
            handleSearch();
        }

        function saveFromModal() {
            save(currentEditingDayId, document.getElementById('modalText').value, 'text');
            closeModal();
        }

        function renderCalendar() {
            const container = document.getElementById('calendar');
            container.innerHTML = '';
            const savedData = load();

            // Obtener fecha actual para comparar
            const today = new Date();
            const tDay = today.getDate();
            const tMonth = today.getMonth();
            const tYear = today.getFullYear();

            months.forEach((monthName, monthIndex) => {
                const monthDiv = document.createElement('div');
                monthDiv.className = 'month';
                monthDiv.innerHTML = `<div class="month-header"><div class="month-title">${monthName}</div><div class="clear-month" onclick="clearMonth(${monthIndex})">Limpiar</div></div>`;
                
                const daysGrid = document.createElement('div');
                daysGrid.className = 'days-grid';
                dayNames.forEach(d => daysGrid.innerHTML += `<div class="day-header">${d}</div>`);

                const firstDay = new Date(2026, monthIndex, 1).getDay();
                const daysInMonth = new Date(2026, monthIndex + 1, 0).getDate();

                for (let i = 0; i < firstDay; i++) daysGrid.innerHTML += `<div></div>`;

                for (let d = 1; d <= daysInMonth; d++) {
                    const dayId = `${monthIndex}-${d}`;
                    const dayData = savedData[dayId] || {};
                    const dayDiv = document.createElement('div');
                    
                    // L√≥gica para marcar "HOY"
                    let classNames = 'day';
                    if (tYear === 2026 && tMonth === monthIndex && tDay === d) {
                        classNames += ' today';
                    }
                    
                    dayDiv.className = classNames;
                    dayDiv.style.backgroundColor = dayData.color || 'white';
                    dayDiv.onclick = () => openModal(dayId, `${d} de ${monthName}`);
                    dayDiv.innerHTML = `<div class="day-number">${d}</div><div class="day-preview">${dayData.text || ''}</div>`;
                    daysGrid.appendChild(dayDiv);
                }
                monthDiv.appendChild(daysGrid);
                container.appendChild(monthDiv);
            });
        }

        window.onclick = (e) => { if (e.target.id == 'dayModal') closeModal(); }
        renderCalendar();
    </script>
</body>
</html>
